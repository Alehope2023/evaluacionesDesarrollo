{"ast":null,"code":"import _slicedToArray from\"C:/trabajo/Alehope/actividadesPreBuild/Frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import{makeStyles}from'@material-ui/core';import GridContainer from'components/Grid/GridContainer';import GridItem from'components/Grid/GridItem';import Button from'components/CustomButtons/Button';import Card from'components/Card/Card';import CardBody from'components/Card/CardBody';import CardHeader from'components/Card/CardHeader';import{logout,login}from'redux/actions/userActions';import styles from'./styles/loginScreenStyles';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(styles);var LoginScreen=function LoginScreen(_ref){var location=_ref.location,history=_ref.history;var dispatch=useDispatch();var classes=useStyles();var _useState=useState('cardHidden'),_useState2=_slicedToArray(_useState,2),cardAnimaton=_useState2[0],setCardAnimation=_useState2[1];var _useSelector=useSelector(function(state){return state.userLogin;}),loadingUserInfo=_useSelector.loadingUserInfo,errorUserInfo=_useSelector.errorUserInfo,userInfo=_useSelector.userInfo;var redirectToLogin=function redirectToLogin(){window.location.replace(process.env.REACT_APP_API+'/login');};var redirect=location.search?location.search.split('=')[1]:'/admin/user-page';useEffect(function(){if(userInfo){//Chequamos si el token es valido, sino se tiene que autenticar.\nvar tokenToVerify=localStorage.getItem('setADA')?JSON.parse(localStorage.getItem('setADA')):null;axios({method:'POST',url:'/api/users/verifyToken',headers:{Authorization:\"Bearer \".concat(tokenToVerify),'Cache-Control':'no-cache'},withCredentials:true}).then(function(response){history.push(redirect);}).catch(function(error){//Borramos la informacion ya que esta expirada Haciendo logout.\ndispatch(logout());return function cleanup(){window.clearTimeout(id);};});}else{if(!loadingUserInfo){axios({method:'GET',url:'/whoami',withCredentials:true}).then(function(response){if(response.data.codAyre){dispatch(login(response.data));}else{return function cleanup(){window.clearTimeout(id);};}}).catch(function(error){return function cleanup(){window.clearTimeout(id);};});}}},[history,userInfo,redirect]);useEffect(function(){var id=setTimeout(function(){setCardAnimation('');},200);return function cleanup(){window.clearTimeout(id);};});var loginHandler=function loginHandler(e){e.preventDefault();redirectToLogin();};return/*#__PURE__*/_jsx(\"div\",{className:classes.container,children:/*#__PURE__*/_jsx(GridContainer,{justifyContent:\"center\",children:/*#__PURE__*/_jsx(GridItem,{xs:12,sm:10,md:4,children:/*#__PURE__*/_jsxs(Card,{loginRegister:true,className:\"\".concat(classes[cardAnimaton],\" \").concat(classes.cardRoot),children:[/*#__PURE__*/_jsx(CardHeader,{className:classes.cardHeader,color:\"primary\",children:/*#__PURE__*/_jsx(\"h4\",{className:classes.cardTitle,children:\"Accede con tu cuenta\"})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsxs(GridContainer,{children:[/*#__PURE__*/_jsx(GridItem,{xs:12,children:/*#__PURE__*/_jsx(Button,{color:\"primary\",size:\"lg\",block:true,onClick:loginHandler,children:loadingUserInfo?'Iniciando...':'Conectar'})}),errorUserInfo&&/*#__PURE__*/_jsx(GridItem,{xs:12,children:/*#__PURE__*/_jsx(\"div\",{className:classes.messageError,children:errorUserInfo})})]})})]})})})});};export default LoginScreen;","map":{"version":3,"names":["useState","useEffect","useDispatch","useSelector","makeStyles","GridContainer","GridItem","Button","Card","CardBody","CardHeader","logout","login","styles","axios","jsx","_jsx","jsxs","_jsxs","useStyles","LoginScreen","_ref","location","history","dispatch","classes","_useState","_useState2","_slicedToArray","cardAnimaton","setCardAnimation","_useSelector","state","userLogin","loadingUserInfo","errorUserInfo","userInfo","redirectToLogin","window","replace","process","env","REACT_APP_API","redirect","search","split","tokenToVerify","localStorage","getItem","JSON","parse","method","url","headers","Authorization","concat","withCredentials","then","response","push","catch","error","cleanup","clearTimeout","id","data","codAyre","setTimeout","loginHandler","e","preventDefault","className","container","children","justifyContent","xs","sm","md","loginRegister","cardRoot","cardHeader","color","cardTitle","size","block","onClick","messageError"],"sources":["C:/trabajo/Alehope/actividadesPreBuild/Frontend/src/screens/platform-access/LoginScreen/LoginScreen.js"],"sourcesContent":["import { useState, useEffect } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { makeStyles } from '@material-ui/core'\r\nimport GridContainer from 'components/Grid/GridContainer'\r\nimport GridItem from 'components/Grid/GridItem'\r\nimport Button from 'components/CustomButtons/Button'\r\nimport Card from 'components/Card/Card'\r\nimport CardBody from 'components/Card/CardBody'\r\nimport CardHeader from 'components/Card/CardHeader'\r\nimport { logout, login } from 'redux/actions/userActions'\r\nimport styles from './styles/loginScreenStyles'\r\nimport axios from 'axios';\r\n\r\nconst useStyles = makeStyles(styles)\r\n\r\nconst LoginScreen = ({ location, history }) => {\r\n  const dispatch = useDispatch()\r\n  const classes = useStyles()\r\n\r\n  const [cardAnimaton, setCardAnimation] = useState('cardHidden')\r\n\r\n  const { loadingUserInfo, errorUserInfo, userInfo } = useSelector((state) => state.userLogin)\r\n\r\n  const redirectToLogin = () => {\r\n      window.location.replace(process.env.REACT_APP_API + '/login');\r\n  }\r\n  \r\n  const redirect = location.search ? location.search.split('=')[1] : '/admin/user-page'\r\n\r\n  useEffect(() => {\r\n    if (userInfo) {\r\n      //Chequamos si el token es valido, sino se tiene que autenticar.\r\n      const tokenToVerify = localStorage.getItem('setADA') ? JSON.parse(localStorage.getItem('setADA')) : null\r\n      axios({\r\n        method: 'POST',\r\n        url: '/api/users/verifyToken',\r\n        headers:  {\r\n                    Authorization: `Bearer ${tokenToVerify}`,\r\n                    'Cache-Control': 'no-cache',\r\n                  },\r\n        withCredentials: true\r\n      }).then(response => {\r\n        history.push(redirect)\r\n      })\r\n      .catch(error => {\r\n        //Borramos la informacion ya que esta expirada Haciendo logout.\r\n        dispatch(logout())\r\n      \r\n        return function cleanup() {\r\n          window.clearTimeout(id)\r\n        }\r\n      })\r\n    }\r\n    else {\r\n      if(!loadingUserInfo) {\r\n        axios({\r\n          method: 'GET',\r\n          url: '/whoami',\r\n          withCredentials: true\r\n        })\r\n        .then(response => {\r\n          if (response.data.codAyre)\r\n          {\r\n            dispatch(login(response.data))\r\n          }\r\n          else\r\n          {\r\n            return function cleanup() {\r\n              window.clearTimeout(id)\r\n            }\r\n          }\r\n        })\r\n        .catch(error => {\r\n          return function cleanup() {\r\n            window.clearTimeout(id)\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }, [history, userInfo, redirect])\r\n\r\n  useEffect(() => {\r\n    let id = setTimeout(function () {\r\n      setCardAnimation('')\r\n    }, 200)\r\n\r\n    return function cleanup() {\r\n      window.clearTimeout(id)\r\n    }\r\n  })\r\n\r\n  const loginHandler = (e) => {\r\n    e.preventDefault()\r\n    redirectToLogin()\r\n  }\r\n\r\n  return (\r\n    <div className={classes.container}>\r\n      <GridContainer justifyContent='center'>\r\n        <GridItem xs={12} sm={10} md={4}>\r\n          <Card loginRegister className={`${classes[cardAnimaton]} ${classes.cardRoot}`}>\r\n            <CardHeader className={classes.cardHeader} color='primary'>\r\n              <h4 className={classes.cardTitle}>Accede con tu cuenta</h4>\r\n            </CardHeader>\r\n            <CardBody>\r\n              <GridContainer>\r\n                <GridItem xs={12}>\r\n                  <Button color='primary' size='lg' block onClick={loginHandler}>\r\n                    {loadingUserInfo ? 'Iniciando...' : 'Conectar'}\r\n                  </Button>\r\n                </GridItem>\r\n                {errorUserInfo && (\r\n                  <GridItem xs={12}>\r\n                    <div className={classes.messageError}>{errorUserInfo}</div>\r\n                  </GridItem>\r\n                )}\r\n              </GridContainer>\r\n            </CardBody>\r\n          </Card>\r\n        </GridItem>\r\n      </GridContainer>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default LoginScreen\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}